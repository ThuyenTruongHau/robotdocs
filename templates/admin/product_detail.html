{% extends 'admin/base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Thado Robot Admin{% endblock %}
{% block page_title %}{{ product.name }}{% endblock %}

{% block page_actions %}
<div class="btn-group" role="group">
    <a href="{% url 'manage_product:product_list' %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Quay lại
    </a>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Product Info -->
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle text-primary"></i> Thông tin chi tiết
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        {% if images.first %}
                            <div class="product-image-container">
                                <img src="{{ images.first.image.url }}" alt="{{ product.name }}" 
                                     class="img-fluid rounded shadow-sm product-main-image">
                                <div class="image-overlay">
                                    <span class="badge bg-primary">{{ images_count }} ảnh</span>
                                </div>
                            </div>
                        {% else %}
                            <div class="bg-light d-flex align-items-center justify-content-center rounded product-placeholder" 
                                 style="height: 250px;">
                                <div class="text-center">
                                    <i class="fas fa-image fa-3x text-muted mb-2"></i>
                                    <p class="text-muted small">Chưa có hình ảnh</p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-8">
                        <div class="product-details">
                            <div class="detail-item">
                                <label class="detail-label">ID Sản phẩm</label>
                                <span class="detail-value">{{ product.id }}</span>
                            </div>
                            
                            <div class="detail-item">
                                <label class="detail-label">Category</label>
                                <span class="badge bg-info fs-6">{{ product.category.name }}</span>
                            </div>
                            
                            <div class="detail-item">
                                <label class="detail-label">Brand</label>
                                <span class="badge bg-success fs-6">{{ product.brand.name }}</span>
                            </div>
                            
                            <div class="detail-item">
                                <label class="detail-label">Mô tả</label>
                                <div class="detail-value">
                                    {% if product.description %}
                                        <p class="mb-0">{{ product.description }}</p>
                                    {% else %}
                                        <span class="text-muted">Không có mô tả</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="detail-item">
                                <label class="detail-label">Thời gian</label>
                                <div class="detail-value">
                                    <small class="text-muted">
                                        Tạo: {{ product.created_at|date:"d/m/Y H:i" }}<br>
                                        Cập nhật: {{ product.updated_at|date:"d/m/Y H:i" }}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions & Stats -->
    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-bolt text-warning"></i> Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'manage_product:product_edit' product.pk %}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Chỉnh sửa sản phẩm
                    </a>
                    <button type="button" class="btn btn-outline-danger product-delete-btn" 
                            data-product-id="{{ product.pk }}" 
                            data-product-name="{{ product.name }}">
                        <i class="fas fa-trash"></i> Xóa sản phẩm
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar text-info"></i> Thống kê
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="stat-item">
                            <h3 class="text-primary mb-1">{{ images_count }}</h3>
                            <p class="text-muted small mb-0">Hình ảnh</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="stat-item">
                            <h3 class="text-success mb-1">{{ product.parameters|length|default:0 }}</h3>
                            <p class="text-muted small mb-0">Thông số</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Info -->
        <div class="card shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-tag text-info"></i> Thông tin category
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center">
                    {% if product.category.image %}
                        <img src="{{ product.category.image.url }}" alt="{{ product.category.name }}" 
                             class="rounded me-3" style="width: 50px; height: 50px; object-fit: cover;">
                    {% else %}
                        <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center" 
                             style="width: 50px; height: 50px;">
                            <i class="fas fa-tag text-muted"></i>
                        </div>
                    {% endif %}
                    <div>
                        <h6 class="mb-1">{{ product.category.name }}</h6>
                        <small class="text-muted">
                            {% if product.category.description %}
                                {{ product.category.description|truncatechars:50 }}
                            {% else %}
                                Không có mô tả
                            {% endif %}
                        </small>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="{% url 'manage_category:category_detail' product.category.pk %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i> Xem chi tiết
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Technical Parameters -->
{% if product.parameters %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-cogs"></i> Thông số kỹ thuật
                </h5>
                {% if product.parameters %}
                    <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#parametersCollapse" aria-expanded="false">
                        <i class="fas fa-cogs"></i> Xem chi tiết
                    </button>
                {% else %}
                    <span class="text-muted">Không có thông số</span>
                {% endif %}
            </div>
            <div class="card-body">
                <div class="collapse" id="parametersCollapse">
                    <div class="row">
                        {% for section_name, section_data in product.parameters.items %}
                        <div class="col-lg-6 mb-4">
                            <div class="card h-100 border-0 shadow-sm parameter-card">
                                <div class="card-header parameter-header text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-{% if section_name == 'Basic' %}cog{% elif section_name == 'Battery' %}battery-half{% elif section_name == 'Performance' %}tachometer-alt{% elif section_name == 'Obstacle Avoidance' %}shield-alt{% elif section_name == 'Operating Environment' %}thermometer-half{% else %}list{% endif %}"></i>
                                        {{ section_name }}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-borderless mb-0 parameter-table">
                                            {% for param_name, param_value in section_data.items %}
                                            <tr>
                                                <td class="fw-bold text-muted" style="width: 40%;">{{ param_name }}:</td>
                                                <td class="text-dark">{{ param_value }}</td>
                                            </tr>
                                            {% endfor %}
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Product Images -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-images"></i> Hình ảnh Product
                </h5>
                <a href="{% url 'manage_product:product_image_add' product.pk %}" class="btn btn-sm btn-success">
                    <i class="fas fa-plus"></i> Thêm Hình Ảnh
                </a>
            </div>
            <div class="card-body">
                {% if images %}
                    <div class="row">
                        {% for image in images %}
                        <div class="col-md-3 mb-3">
                            <div class="card">
                                <img src="{{ image.image.url }}" alt="{{ product.name }}" 
                                     class="card-img-top" style="height: 200px; object-fit: cover;">
                                <div class="card-body p-2">
                                    <small class="text-muted">
                                        {{ image.uploaded_at|date:"d/m/Y H:i" }}
                                    </small>
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-sm btn-outline-danger product-image-delete-btn" 
                                                data-image-id="{{ image.pk }}" 
                                                data-image-url="{{ image.image.url }}" 
                                                data-product-name="{{ product.name }}" 
                                                data-uploaded-at="{{ image.uploaded_at|date:'d/m/Y H:i:s' }}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-images fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Chưa có hình ảnh nào</h5>
                        <p class="text-muted">Hãy thêm hình ảnh đầu tiên</p>
                        <a href="{% url 'manage_product:product_image_add' product.pk %}" class="btn btn-success">
                            <i class="fas fa-plus"></i> Thêm Hình Ảnh
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Xử lý collapse animation cho thông số kỹ thuật
    const parametersCollapse = document.getElementById('parametersCollapse');
    const toggleBtn = document.querySelector('[data-bs-target="#parametersCollapse"]');
    
    if (parametersCollapse && toggleBtn) {
        parametersCollapse.addEventListener('show.bs.collapse', function () {
            toggleBtn.innerHTML = '<i class="fas fa-cogs"></i> Ẩn chi tiết';
            toggleBtn.classList.remove('btn-outline-primary');
            toggleBtn.classList.add('btn-primary');
        });
        
        parametersCollapse.addEventListener('hide.bs.collapse', function () {
            toggleBtn.innerHTML = '<i class="fas fa-cogs"></i> Xem chi tiết';
            toggleBtn.classList.remove('btn-primary');
            toggleBtn.classList.add('btn-outline-primary');
        });
    }
    
    // Thêm hiệu ứng hover cho các card thông số
    const parameterCards = document.querySelectorAll('.card.h-100');
    parameterCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Thêm hiệu ứng click cho các card
    parameterCards.forEach(card => {
        card.addEventListener('click', function() {
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
});
</script>

<script src="{% static 'js/product-delete.js' %}"></script>
<script src="{% static 'js/product-image-delete.js' %}"></script>

<style>
/* Custom styles cho trang chi tiết sản phẩm */
.product-image-container {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
}

.product-main-image {
    transition: transform 0.3s ease;
    width: 100%;
    height: 250px;
    object-fit: cover;
}

.product-image-container:hover .product-main-image {
    transform: scale(1.05);
}

.image-overlay {
    position: absolute;
    top: 10px;
    right: 10px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.product-image-container:hover .image-overlay {
    opacity: 1;
}

.product-placeholder {
    border: 2px dashed #dee2e6;
    transition: all 0.3s ease;
}

.product-placeholder:hover {
    border-color: #36A9A9;
    background-color: #f8f9fa;
}

.product-details {
    padding: 0;
}

.detail-item {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #f1f3f4;
}

.detail-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.detail-label {
    display: block;
    font-weight: 600;
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.detail-value {
    color: #212529;
    font-size: 1rem;
}

.stat-item {
    padding: 0.5rem;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.stat-item:hover {
    background-color: #f8f9fa;
}

.parameter-section {
    transition: all 0.3s ease;
}

.parameter-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.parameter-card {
    border-left: 4px solid #36A9A9;
    transition: all 0.3s ease;
}

.parameter-card:hover {
    border-left-color: #2a8a8a;
    box-shadow: 0 4px 15px rgba(54, 169, 169, 0.2);
}

.parameter-header {
    background: linear-gradient(135deg, #36A9A9, #2a8a8a) !important;
    border: none;
}

.parameter-table tr:hover {
    background-color: #f8f9fa;
}

.parameter-table td:first-child {
    color: #6c757d;
    font-weight: 600;
    font-size: 0.9rem;
}

.parameter-table td:last-child {
    color: #212529;
    font-weight: 500;
}

/* Animation cho collapse */
.collapse {
    transition: height 0.35s ease;
}

/* Custom scrollbar cho table */
.table-responsive::-webkit-scrollbar {
    height: 6px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #36A9A9;
    border-radius: 3px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #2a8a8a;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .parameter-card {
        margin-bottom: 1rem;
    }
    
    .parameter-table td:first-child {
        font-size: 0.8rem;
    }
    
    .parameter-table td:last-child {
        font-size: 0.85rem;
    }
}
</style>

{% include 'admin/partials/product_delete_modal.html' %}
{% include 'admin/partials/product_image_delete_modal.html' %}
{% endblock %}
